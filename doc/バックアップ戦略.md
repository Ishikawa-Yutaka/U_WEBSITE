# バックアップ戦略ガイド

U_WEBプロジェクトのバックアップとデータ管理の完全ガイド

---

## WordPressサイトの構成要素

WordPressは **2つの要素** で構成されています：

### 1. ファイル
```
/wp-content/themes/     # テーマファイル（HTML, CSS, PHP）
/wp-content/plugins/    # プラグイン
/wp-content/uploads/    # 画像・動画・PDFなど
```

### 2. データベース
```
MySQL/MariaDB
├── 投稿記事
├── 固定ページ
├── サイト設定
├── ユーザー情報
└── コメント等
```

**⚠️ 重要: 両方がないと完全には復元できません！**

---

## バックアップの保存場所

### GitHub（コード管理）

**保存するもの:**
- ✅ カスタムテーマファイル
- ✅ sample_code（元のHTMLデザイン）
- ✅ README.md、ドキュメント

**保存しないもの:**
- ❌ データベース（容量大、個人情報含む）
- ❌ WordPress本体（公式からダウンロード可能）
- ❌ サードパーティプラグイン（再インストール可能）
- ❌ アップロード画像（別途バックアップ）

**理由:**
- コードのバージョン管理に最適
- 軽量（5MB〜20MB程度）
- どこからでもアクセス可能
- 変更履歴が残る

---

### ローカル or Google Drive（完全バックアップ）

**保存するもの:**
- ✅ All-in-One WP Migration の `.wpress` ファイル
  - データベース全体
  - 全ファイル
  - 設定情報
  - アップロード画像
  - **これ1つで完全復元可能！**

**保存頻度:**
- 開発中: 大きな変更の度
- 本番稼働後: 月1回程度

---

### エックスサーバー（本番環境）

**自動バックアップ（無料）:**
- 過去14日分を自動保存
- サーバー管理画面から復元可能

**手動バックアップ:**
- All-in-One WP Migrationでエクスポート
- FTPで全ファイルダウンロード（任意）

---

## バックアップ方法

### 1. All-in-One WP Migration（推奨）

**メリット:**
- 最も簡単
- ワンクリックでエクスポート/インポート
- データベース + ファイル全て含む
- サーバー移行も楽

**手順:**
```
WordPress管理画面
↓
プラグイン → All-in-One WP Migration → Export
↓
Export To → File
↓
.wpress ファイルがダウンロードされる
↓
Google Driveやローカルに保存
```

**インポート（復元）:**
```
新しい環境でWordPressインストール
↓
All-in-One WP Migration → Import
↓
.wpress ファイルをアップロード
↓
完全復元！
```

---

### 2. データベースを手動エクスポート

**手順:**
```
Localアプリ → Database → Adminer
↓
Export → SQL
↓
database.sql ファイルをダウンロード
```

**⚠️ 注意:**
- SQLファイルは容量が大きい
- GitHubには保存しない
- パスワードやメールアドレスが含まれる

---

## プロジェクトのライフサイクル

### 開発中

```
【作業環境】
~/Local Sites/uwebsite/  ← ローカル開発環境
└── テーマファイルを編集

【バックアップ】
1. GitHub
   - テーマファイルを定期的に push
   - git commit で変更履歴を記録

2. Google Drive（任意）
   - All-in-One WP Migration の .wpress
   - 週1回程度エクスポート
```

---

### 本番公開後

```
【本番環境】
エックスサーバー
├── 自動バックアップ（過去14日分）
└── 手動バックアップ（月1回）

【GitHub】
- テーマファイルの最新版を維持
- 修正の度に commit & push

【ローカル環境】
~/Local Sites/uwebsite/  ← 削除OK
→ 容量節約（500MB〜1GB）
→ 必要なら再構築可能
```

---

### プロジェクト完了後

```
【保存するもの】
1. GitHub
   /Users/Uni/Uni_MacBookAir/SITE_U-WEB/wp_code/
   ├── themes/u-web-theme/  ← カスタムテーマ
   ├── sample_code/         ← 元のHTML
   ├── doc/                 ← ドキュメント
   └── README.md
   → 容量: 約10MB〜30MB

2. Google Drive
   - 最終版の .wpress ファイル
   → 容量: 約50MB〜200MB

【削除するもの】
~/Local Sites/uwebsite/  ← 完全削除OK
→ 容量節約: 500MB〜1GB
```

---

## サイト復元方法

### シナリオ1: 新しいPCで開発を再開

```bash
# ステップ1: GitHubからテーマを取得
git clone https://github.com/Ishikawa-Yutaka/U_WEBSITE
cd wp_code

# ステップ2: Localで新規サイト作成
# Localアプリで「Create a new site」

# ステップ3: All-in-One WP Migrationでインポート
# .wpress ファイルをアップロード

# ステップ4: テーマを配置
# GitHubのテーマをLocalのthemesフォルダにコピー

# 完了！
```

---

### シナリオ2: 本番サイトを修正したい

```
【方法A: 本番環境で直接修正】
1. エックスサーバーにログイン
2. テーマファイルをFTPで修正
3. 修正後、GitHubに反映

【方法B: ローカルで修正してアップロード】
1. Localで新規サイト作成
2. 本番データを All-in-One WP Migration でエクスポート
3. Localにインポート
4. 修正
5. 本番へ再アップロード
```

---

### シナリオ3: PCが壊れた！

```
【復旧手順】
1. 新しいPCを購入
2. git clone https://github.com/Ishikawa-Yutaka/U_WEBSITE
   → テーマファイル復元

3. Google Driveから .wpress ファイルをダウンロード
   → 完全なサイトデータ

4. Localをインストール
5. 新規サイト作成 → .wpress インポート
   → 完全復元！

所要時間: 約30分
```

---

## ベストプラクティス

### 定期的なバックアップ

```
【開発中】
- Git commit & push: 毎日の作業終了時
- .wpress エクスポート: 大きな変更後

【本番稼働後】
- Git commit & push: テーマ修正の度
- .wpress エクスポート: 月1回
- エックスサーバー自動バックアップ: 自動（確認不要）
```

---

### コミットメッセージの例

```bash
git commit -m "ヘッダーデザイン修正"
git commit -m "お問い合わせフォーム追加"
git commit -m "レスポンシブ対応完了"
git commit -m "本番公開前最終調整"
```

---

## 容量の目安

| 項目 | 容量 | 保存場所 |
|---|---|---|
| カスタムテーマ | 5MB〜10MB | GitHub |
| sample_code | 2MB〜5MB | GitHub |
| .wpress ファイル | 50MB〜500MB | Google Drive |
| Local環境全体 | 500MB〜1GB | ローカル（削除可） |
| 本番サイト | 100MB〜2GB | エックスサーバー |

---

## チェックリスト

### 開発開始時
- [ ] GitHub リポジトリ作成完了
- [ ] Localで開発環境構築完了
- [ ] テーマファイルをGit管理下に配置

### 開発中（毎日）
- [ ] 作業終了時に git commit & push
- [ ] 大きな変更後に .wpress エクスポート

### 本番公開前
- [ ] 最終版を .wpress でエクスポート
- [ ] GitHubに最新版をプッシュ
- [ ] README.md を更新

### 本番公開後
- [ ] エックスサーバー自動バックアップ設定確認
- [ ] 月1回 .wpress でバックアップ
- [ ] Localフォルダを削除（任意）

### プロジェクト完了時
- [ ] 最終版の .wpress を Google Drive に保存
- [ ] GitHubに全ファイルをプッシュ
- [ ] Localフォルダを削除
- [ ] ドキュメントを更新

---

## トラブルシューティング

### Q: .wpress ファイルが大きすぎてアップロードできない

**A:** エックスサーバーの場合
```
1. サーバーパネルで php.ini を編集
2. upload_max_filesize = 512M
3. post_max_size = 512M
4. 再アップロード
```

---

### Q: GitHubの容量制限は？

**A:**
- 無料プラン: 1リポジトリあたり制限なし
- ファイル1個: 100MB以下推奨
- テーマファイル程度なら問題なし

---

### Q: Google Driveの容量は？

**A:**
- 無料プラン: 15GB
- .wpress ファイル: 約50MB〜200MB
- 数十個のバックアップを保存可能

---

## まとめ

### 3つの保存場所を使い分ける

1. **GitHub** → コード管理（テーマファイル）
2. **Google Drive** → 完全バックアップ（.wpress）
3. **エックスサーバー** → 本番環境＋自動バックアップ

### 最小限の労力で最大限の安全

- 毎日: git commit（30秒）
- 月1回: .wpress エクスポート（5分）
- 常時: エックスサーバー自動バックアップ（自動）

**これで万全です！**
